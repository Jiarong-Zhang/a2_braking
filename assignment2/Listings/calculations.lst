C166 COMPILER V7.57.0, CALCULATIONS                                                        10/07/2022 00:54:52 PAGE 1   


C166 COMPILER V7.57.0, COMPILATION OF MODULE CALCULATIONS
OBJECT MODULE PLACED IN .\Objects\calculations.obj
COMPILER INVOKED BY: D:\Keil\C166\BIN\C166.EXE Source\calculations.c BROWSE MOD167 DEBUG PRINT(.\Listings\calculations.l
                    -st) TABS(2) OBJECT(.\Objects\calculations.obj) 

 stmt lvl     source

    1         // a1793769 - Emily Zhang
    2         /**
    3          * File name calculations.c
    4          * Description: Implementation for operations that perfrom the main
    5         torque & braking distance calculations 
    6         **/
    7         
    8         /********** Include required submodules**********/
    9         
   10         #include "calculations.h"
   11         
   12         /********** Function Definitions **********/
   13         
   14         // v = Rw
   15         float calculateVehicleLinVel(float wheel_ang_vel)
   16         {
   17  1        float result = ROLLING_RADIUS * wheel_ang_vel;
   18  1        return result;
   19  1      }
   20         
   21         // s = 0.36v + 0.1v^2
   22         float calculateMinBrkDist(float vehicle_lin_vel)
   23         {
   24  1        float result = (0.36 * vehicle_lin_vel) +
   25  1           (0.1 * (vehicle_lin_vel * vehicle_lin_vel));
   26  1        return result;
   27  1      }
   28         
   29         float calculateRelativeVel(void)
   30         {
   31  1        float result = 0.5 * (g_dist_buffer[BUFFER_SIZE - 1] -
   32  1           g_dist_buffer[0]);
   33  1      
   34  1        return result;
   35  1      }
   36         
   37         float calculateBrakingTorque(float vehicle_lin_vel, float dist_to_obst)
   38         {
   39  1        float deceleration = 0;
   40  1        float wheel_ang_acc = 0;
   41  1        float est_brk_force = 0;
   42  1        float braking_torque = 0;
   43  1      
   44  1        // a = -(v^2)/(2d)
   45  1        deceleration = -(vehicle_lin_vel * vehicle_lin_vel)/(2 * dist_to_obst);
   46  1      
   47  1        // wheel_ang_acc = a/R
   48  1        wheel_ang_acc = deceleration/ROLLING_RADIUS;
   49  1      
   50  1        // ma = -F, F = -ma
   51  1        est_brk_force = -(deceleration * QTR_CAR_MASS);
   52  1      
   53  1        // T = F*R+J(wheel_ang_acc)
   54  1        braking_torque = (est_brk_force * ROLLING_RADIUS) + 
C166 COMPILER V7.57.0, CALCULATIONS                                                        10/07/2022 00:54:52 PAGE 2   

   55  1          (MOMENT_OF_INERTIA * wheel_ang_acc);
   56  1      
   57  1        return braking_torque;
   58  1      }
   59         
   60         void calculationsHandler(void)
   61         {
   62  1        volatile float angular_velocity = 0;
   63  1        volatile float linear_velocity = 0;
   64  1        volatile float min_distance = 0;
   65  1        volatile float relative_velocity = 0;
   66  1        volatile float braking_torque = 0;
   67  1      
   68  1        // First, get vehicle linear velocity
   69  1        angular_velocity = encoderGetVelocity();
   70  1        linear_velocity = calculateVehicleLinVel(angular_velocity);
   71  1      
   72  1        // Then check minimum braking distance
   73  1        min_distance = calculateMinBrkDist(linear_velocity);
   74  1      
   75  1        // Also check relative velocity
   76  1        relative_velocity = calculateRelativeVel();
   77  1      
   78  1        // Calculate relative braking torque
   79  1        braking_torque = calculateBrakingTorque(linear_velocity, g_dist_buffer[1]);
   80  1      
   81  1        // Clear output to DAC
   82  1        dacReset();
   83  1      
   84  1        // Send warning? (distance)
   85  1        if ((min_distance > g_dist_buffer[1]) && (relative_velocity < 0))
   86  1        {
   87  2          // send warning, do not write to DAC
   88  2          aebWarning();
   89  2        }
   90  1        // Send warning? (torque)
   91  1        else if ((braking_torque > MAX_BRAKE_TORQUE) && (relative_velocity < 0))
   92  1        {
   93  2          // send warning,do not write to DAC
   94  2          aebWarning();
   95  2        }
   96  1        else if (braking_torque == 0x00)
   97  1        {
   98  2          dacWrite(0x01);
   99  2        }
  100  1        else if ((braking_torque > 0) && (braking_torque < MAX_BRAKE_TORQUE))
  101  1        {
  102  2          dacWrite((unsigned int)braking_torque * DAC_SCALE_FACTOR);
  103  2        }
  104  1      }


MODULE INFORMATION:   INITIALIZED  UNINITIALIZED
  CODE SIZE        =         694     --------
  NEAR-CONST SIZE  =    --------     --------
  FAR-CONST SIZE   =    --------     --------
  HUGE-CONST SIZE  =    --------     --------
  XHUGE-CONST SIZE =    --------     --------
  NEAR-DATA SIZE   =    --------     --------
  FAR-DATA SIZE    =    --------     --------
  XHUGE-DATA SIZE  =    --------     --------
  IDATA-DATA SIZE  =    --------     --------
C166 COMPILER V7.57.0, CALCULATIONS                                                        10/07/2022 00:54:52 PAGE 3   

  SDATA-DATA SIZE  =    --------     --------
  BDATA-DATA SIZE  =    --------     --------
  HUGE-DATA SIZE   =    --------     --------
  BIT SIZE         =    --------     --------
  INIT'L SIZE      =    --------     --------
END OF MODULE INFORMATION.


C166 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
