C166 COMPILER V7.57.0, CALCULATIONS                                                        10/06/2022 23:34:44 PAGE 1   


C166 COMPILER V7.57.0, COMPILATION OF MODULE CALCULATIONS
OBJECT MODULE PLACED IN .\Objects\calculations.obj
COMPILER INVOKED BY: D:\Keil\C166\BIN\C166.EXE Source\calculations.c BROWSE MOD167 DEBUG PRINT(.\Listings\calculations.l
                    -st) TABS(2) OBJECT(.\Objects\calculations.obj) 

 stmt lvl     source

    1         // a1793769 - Emily Zhang
    2         /**
    3         Implementation for operations that perfrom the main
    4         torque & braking distance calculations 
    5         **/
    6         
    7         /* Include required submodules */
    8         #include "calculations.h"
    9         
   10         /********** Function Definitions **********/
   11         
   12         // v = Rw
   13         float calculateVehicleLinVel(float wheel_ang_vel)
   14         {
   15  1        float result = ROLLING_RADIUS * wheel_ang_vel;
   16  1        return result;
   17  1      }
   18         
   19         // s = 0.36v + 0.1v^2
   20         float calculateMinBrkDist(float vehicle_lin_vel)
   21         {
   22  1        float result = (0.36 * vehicle_lin_vel) +
   23  1           (0.1 * (vehicle_lin_vel * vehicle_lin_vel));
   24  1        return result;
   25  1      }
   26         
   27         float calculateRelativeVel(void)
   28         {
   29  1        float result = 0.5 * (g_dist_buffer[BUFFER_SIZE - 1] -
   30  1           g_dist_buffer[0]);
   31  1      
   32  1        return result;
   33  1      }
   34         
   35         float calculateBrakingTorque(float vehicle_lin_vel, float dist_to_obst)
   36         {
   37  1        float deceleration = 0;
   38  1        float wheel_ang_acc = 0;
   39  1        float est_brk_force = 0;
   40  1        float braking_torque = 0;
   41  1      
   42  1        // a = -(v^2)/(2d)
   43  1        deceleration = -(vehicle_lin_vel * vehicle_lin_vel)/(2 * dist_to_obst);
   44  1      
   45  1        // wheel_ang_acc = a/R
   46  1        wheel_ang_acc = deceleration/ROLLING_RADIUS;
   47  1      
   48  1        // ma = -F, F = -ma
   49  1        est_brk_force = -(deceleration * QTR_CAR_MASS);
   50  1      
   51  1        // T = F*R+J(wheel_ang_acc)
   52  1        braking_torque = (est_brk_force * ROLLING_RADIUS) + 
   53  1          (MOMENT_OF_INERTIA * wheel_ang_acc);
   54  1      
C166 COMPILER V7.57.0, CALCULATIONS                                                        10/06/2022 23:34:44 PAGE 2   

   55  1        return braking_torque;
   56  1      }
   57         
   58         void calculationsHandler(void)
   59         {
   60  1        volatile float angular_velocity = 0;
   61  1        volatile float linear_velocity = 0;
   62  1        volatile float min_distance = 0;
   63  1        volatile float relative_velocity = 0;
   64  1        volatile float braking_torque = 0;
   65  1      
   66  1        // First, get vehicle linear velocity
   67  1        angular_velocity = encoderGetVelocity();
   68  1        linear_velocity = calculateVehicleLinVel(angular_velocity);
   69  1      
   70  1        // Then check minimum braking distance
   71  1        min_distance = calculateMinBrkDist(linear_velocity);
   72  1      
   73  1        // Also check relative velocity
   74  1        relative_velocity = calculateRelativeVel();
   75  1      
   76  1        // Calculate relative braking torque
   77  1        braking_torque = calculateBrakingTorque(linear_velocity, g_dist_buffer[1]);
   78  1      
   79  1        // Clear output to DAC
   80  1        dacReset();
   81  1      
   82  1        // Send warning? (distance)
   83  1        if ((min_distance > g_dist_buffer[1]) && (relative_velocity < 0))
   84  1        {
   85  2          // send warning, do not write to DAC
   86  2          aebWarning();
   87  2        }
   88  1        // Send warning? (torque)
   89  1        else if ((braking_torque > MAX_BRAKE_TORQUE) && (relative_velocity < 0))
   90  1        {
   91  2          // send warning,do not write to DAC
   92  2          aebWarning();
   93  2        }
   94  1        else if (braking_torque == 0x00)
   95  1        {
   96  2          dacWrite(0x01);
   97  2        }
   98  1        else if ((braking_torque > 0) && (braking_torque < MAX_BRAKE_TORQUE))
   99  1        {
  100  2          dacWrite((unsigned int)braking_torque * DAC_SCALE_FACTOR);
  101  2        }
  102  1      }


MODULE INFORMATION:   INITIALIZED  UNINITIALIZED
  CODE SIZE        =         694     --------
  NEAR-CONST SIZE  =    --------     --------
  FAR-CONST SIZE   =    --------     --------
  HUGE-CONST SIZE  =    --------     --------
  XHUGE-CONST SIZE =    --------     --------
  NEAR-DATA SIZE   =    --------     --------
  FAR-DATA SIZE    =    --------     --------
  XHUGE-DATA SIZE  =    --------     --------
  IDATA-DATA SIZE  =    --------     --------
  SDATA-DATA SIZE  =    --------     --------
  BDATA-DATA SIZE  =    --------     --------
C166 COMPILER V7.57.0, CALCULATIONS                                                        10/06/2022 23:34:44 PAGE 3   

  HUGE-DATA SIZE   =    --------     --------
  BIT SIZE         =    --------     --------
  INIT'L SIZE      =    --------     --------
END OF MODULE INFORMATION.


C166 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
